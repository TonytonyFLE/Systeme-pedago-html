<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">Cours Interactif</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .quote {
            font-style: italic;
            margin-top: 15px;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 40px;
        }

        .section-title {
            font-size: 2rem;
            color: #2c3e50;
            margin-bottom: 25px;
            padding-bottom: 10px;
            border-bottom: 3px solid #3498db;
        }

        .subsection-title {
            font-size: 1.5rem;
            color: #34495e;
            margin: 30px 0 20px 0;
            padding-left: 15px;
            border-left: 4px solid #e74c3c;
        }

        .theory-box {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid #3498db;
        }

        .example-box {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .example-title {
            font-weight: bold;
            color: #856404;
            margin-bottom: 15px;
        }

        .divisibility-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .divisibility-table th {
            background: #3498db;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .divisibility-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #ecf0f1;
        }

        .divisibility-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .divisibility-table tr:hover {
            background: #e8f4f8;
        }

        .priority-list {
            background: #e8f5e8;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .priority-list ol {
            margin-left: 20px;
        }

        .priority-list li {
            margin-bottom: 8px;
            font-weight: 500;
        }

        .calculator-steps {
            background: #f0f8ff;
            border: 1px solid #b3d9ff;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .calculator-steps ol {
            margin-left: 20px;
        }

        .calculator-steps li {
            margin-bottom: 10px;
        }

        .exercise {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            border-left: 5px solid #e74c3c;
            transition: all 0.3s ease;
        }

        .exercise:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .exercise-title {
            font-size: 1.4rem;
            color: #2c3e50;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .question {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #e9ecef;
        }

        .question-text {
            font-weight: 500;
            margin-bottom: 15px;
            color: #333;
        }

        .grid-answers {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .answer-input {
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.3s;
            min-width: 80px;
            min-height: 25px;
            outline: none;
            background: white;
            cursor: text;
        }

        .answer-input:focus {
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .answer-input:empty:before {
            content: attr(data-placeholder);
            color: #999;
            font-style: italic;
        }

        .answer-input.correct {
            background-color: #d4edda !important;
            border-color: #c3e6cb !important;
        }

        .answer-input.incorrect {
            background-color: #f8d7da !important;
            border-color: #f5c6cb !important;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn-check {
            background: #27ae60;
            color: white;
        }

        .btn-check:hover {
            background: #229954;
        }

        .btn-solution {
            background: #f39c12;
            color: white;
        }

        .btn-reset {
            background: #95a5a6;
            color: white;
        }

        .feedback {
            margin-top: 15px;
            padding: 15px;
            border-radius: 6px;
            font-weight: 500;
            display: none;
            white-space: pre-line;
        }

        .feedback.correct {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .feedback.incorrect {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .feedback.solution {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            background: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #2c3e50;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #27ae60, #2ecc71);
            width: 0%;
            transition: width 0.5s ease;
        }

        .navigation {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(52, 152, 219, 0.9);
            border-radius: 10px;
            padding: 15px;
            backdrop-filter: blur(10px);
        }

        .nav-btn {
            display: block;
            color: white;
            text-decoration: none;
            padding: 8px 15px;
            margin: 5px 0;
            border-radius: 5px;
            transition: background 0.3s;
            font-size: 0.9rem;
            border: none;
            background: transparent;
            cursor: pointer;
        }

        .nav-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        /* Fractions */
        .fraction {
            display: inline-block;
            vertical-align: middle;
            text-align: center;
            position: relative;
            margin: 0 0.1em;
        }

        .fraction .numerator {
            display: block;
            font-size: 0.85em;
            line-height: 1.1;
            border-bottom: 1px solid black;
            padding: 1px 3px;
        }

        .fraction .denominator {
            display: block;
            font-size: 0.85em;
            line-height: 1.1;
            padding: 1px 3px;
        }

        /* Palette math√©matique */
        .math-palette {
            position: absolute;
            background: white;
            border: 2px solid #3498db;
            border-radius: 12px;
            padding: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            z-index: 1000;
            display: none;
            flex-wrap: wrap;
            gap: 6px;
            max-width: 400px;
        }

        .math-palette.active {
            display: flex;
        }

        .symbol-btn {
            padding: 10px 14px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: #f8f9fa;
            cursor: pointer;
            font-size: 16px;
            min-width: 44px;
            text-align: center;
            transition: all 0.2s ease;
        }

        .symbol-btn:hover {
            background: #e9ecef;
            border-color: #3498db;
        }

        /* Modal */
        #math-help-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #eee;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
        }

        .modal-body {
            padding: 20px;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 10px;
            }
            
            .content {
                padding: 20px;
            }
            
            .navigation {
                position: relative;
                top: 0;
                right: 0;
                margin-bottom: 20px;
            }

            .grid-answers {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="navigation" id="navigation">
        <!-- Navigation dynamique -->
    </div>
    <div class="container">
        <div class="header">
            <h1 id="chapter-title">üìö Cours Interactif</h1>
            <div class="quote" id="chapter-quote">
                <!-- Citation g√©n√©r√©e dynamiquement -->
            </div>
        </div>
        <div class="content">
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-number" id="totalExercises">19</div>
                    <div class="stat-label">Exercices</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="completedExercises">0</div>
                    <div class="stat-label">Compl√©t√©s</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="correctAnswers">0</div>
                    <div class="stat-label">Corrects</div>
                </div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div id="dynamic-content">
                <!-- Contenu g√©n√©r√© par JavaScript -->
            </div>
        </div>
    </div>

    <script>
    /**
     * Utilitaires pour s√©curiser l'injection de contenu dans le DOM
     */
    class DOMSanitizer {
        static sanitizeText(text) {
            if (typeof text !== 'string') return '';
            
            return text
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#x27;');
        }
        
        static createTextElement(tagName, textContent, className = '') {
            const element = document.createElement(tagName);
            element.textContent = textContent;
            if (className) {
                element.className = className;
            }
            return element;
        }
        
        static isTextSafe(text) {
            const dangerousPatterns = [
                /<script/i,
                /<iframe/i,
                /<object/i,
                /<embed/i,
                /javascript:/i,
                /on\w+\s*=/i
            ];
            
            return !dangerousPatterns.some(pattern => pattern.test(text));
        }
    }

    // Donn√©es JSON compl√®tes int√©gr√©es
    const chapterData = {
        "chapter": {
            "number": 1,
            "title": "Bases g√©n√©rales",
            "quote": {
                "text": "Le grand livre de l'univers est √©crit en langage math√©matique.",
                "author": "Galileo Galilei"
            },
            "totalExercises": 19
        },
        "sections": [
            {
                "id": "regles-divisibilite",
                "title": "1.1 R√®gles de divisibilit√©",
                "icon": "üîç",
                "theory": [
                    {
                        "type": "text",
                        "content": "En math√©matiques, les r√®gles de divisibilit√© permettent de savoir si un nombre est divisible par un autre nombre. Pour les petits nombres, on peut tout √† fait essayer rapidement la division. Mais cela va encore plus vite si l'on prend en consid√©ration les r√®gles suivantes :"
                    },
                    {
                        "type": "table",
                        "title": "R√®gles de divisibilit√©",
                        "headers": ["Diviseur", "Test"],
                        "data": [
                            ["2", "Le dernier chiffre est pair."],
                            ["3", "La somme est divisible par 3."],
                            ["4", "Le nombre compos√© des deux derniers chiffres est divisible par 4."],
                            ["5", "Le dernier chiffre est 5 ou 0."],
                            ["6", "Le nombre est divisible par 2 et par 3."],
                            ["7", "Enlever le dernier chiffre, le multiplier par 9 et soustraire ce produit des chiffres restants. Le r√©sultat doit √™tre divisible par 7."],
                            ["8", "Le nombre compos√© par les trois derniers chiffres est divisible par 8."],
                            ["9", "La somme des chiffres est divisible par 9."],
                            ["10", "Le dernier chiffre est 0."],
                            ["11", "La somme altern√©e des chiffres est 0 ou un multiple de 11."],
                            ["12", "Le nombre est divisible par 3 et par 4."],
                            ["13", "Supprimer le dernier chiffre, le multiplier par 9 et soustraire ce produit des chiffres restants. Le r√©sultat doit √™tre divisible par 13."],
                            ["14", "Le nombre est divisible par 2 et par 7."],
                            ["15", "Le nombre est divisible par 3 et par 5."]
                        ]
                    }
                ],
                "examples": [
                    {
                        "title": "Exemple 1.1",
                        "content": "Prenons l'exemple du nombre 1771. On supprime le 1 final puis on calcule 177 - 9 = 168. Si l'on ne sait pas que 24 √ó 7 = 168, on refait la m√™me chose et obtient 16 - 72 = -56. Donc, comme -8 √ó 7 = -56, 1771 est aussi divisible par 7."
                    }
                ]
            },
            {
                "id": "priorite-operations",
                "title": "1.2 Priorit√© des op√©rations",
                "icon": "‚ö°",
                "theory": [
                    {
                        "type": "ordered_list",
                        "title": "üí° Les calculs sont toujours √† faire dans cet ordre :",
                        "items": [
                            "parenth√®ses (de l'int√©rieur √† l'ext√©rieur)",
                            "puissances",
                            "multiplications et divisions",
                            "additions et soustractions"
                        ]
                    },
                    {
                        "type": "text",
                        "content": "‚ö†Ô∏è Attention avec vos calculatrices : certaines ne prennent pas en compte cette r√®gle. Essayez simplement de calculer 1 + 2 √ó 3. Si vous obtenez 7, tout va bien ; si par contre vous obtenez 9, changez de calculatrice."
                    }
                ]
            },
            {
                "id": "calculatrice",
                "title": "1.3 La calculatrice TI-30X II",
                "icon": "üßÆ",
                "theory": [
                    {
                        "type": "text",
                        "content": "Le mode d'emploi suivant correspond √† la calculatrice TI-30X II, mais peut √©galement √™tre utilis√© pour d'autres mod√®les."
                    }
                ],
                "subsections": [
                    {
                        "title": "1.3.1 Arrondir",
                        "content": [
                            {
                                "type": "steps",
                                "items": [
                                    "Appuyez sur 2nd puis sur . pour la fonction fix (en anglais = fix√©).",
                                    "Choisissez le nombre de chiffres apr√®s la virgule moyennant les touches sur lesquelles sont inscrites des fl√®ches.",
                                    "Pressez ENTER."
                                ]
                            },
                            {
                                "type": "text",
                                "content": "Aucun arrondissement n'est v√©ritablement fait. Le nombre est seulement affich√© diff√©remment. La calculatrice continue √† utiliser le nombre exact pour les calculs suivants."
                            }
                        ]
                    }
                ]
            },
            {
                "id": "facteurs-premiers",
                "title": "1.4 Facteurs premiers, PPMC et PGDC",
                "icon": "üî¢",
                "theory": [
                    {
                        "type": "text",
                        "content": "Par nombre premier on entend chaque nombre naturel qui n'est divisible que par 1 et par lui-m√™me sans restes. Donc, par d√©finition, 1 n'est pas un nombre premier."
                    }
                ]
            },
            {
                "id": "ensembles",
                "title": "1.5 Ensembles de nombres",
                "icon": "üåç",
                "theory": [
                    {
                        "type": "text",
                        "content": "Afin de r√©soudre des probl√®mes math√©matiques, il faut toujours d'abord savoir quels chiffres sont √† disposition ; l'ensemble de r√©f√©rence doit √™tre d√©fini."
                    }
                ]
            }
        ],
        "exercises": [
            {
                "id": 1,
                "title": "R√®gles de divisibilit√©",
                "icon": "üîç",
                "type": "grid_input",
                "description": "Trouvez les diviseurs de 2 √† 15 pour les nombres suivants :",
                "questions": [
                    { "label": "a) 149 :", "id": "ex1_149", "answer": "aucun", "placeholder": "ex: 2,3,5" },
                    { "label": "b) 184 :", "id": "ex1_184", "answer": "2,4,8", "placeholder": "ex: 2,3,5" },
                    { "label": "c) 205 :", "id": "ex1_205", "answer": "5", "placeholder": "ex: 2,3,5" },
                    { "label": "d) 148 :", "id": "ex1_148", "answer": "2,4", "placeholder": "ex: 2,3,5" },
                    { "label": "e) 272 :", "id": "ex1_272", "answer": "2,4,8", "placeholder": "ex: 2,3,5" },
                    { "label": "f) 264 :", "id": "ex1_264", "answer": "2,3,4,6,8,11,12", "placeholder": "ex: 2,3,5" },
                    { "label": "g) 121 :", "id": "ex1_121", "answer": "11", "placeholder": "ex: 2,3,5" },
                    { "label": "h) 275 :", "id": "ex1_275", "answer": "5,11", "placeholder": "ex: 2,3,5" },
                    { "label": "i) 208 :", "id": "ex1_208", "answer": "2,4,8,13", "placeholder": "ex: 2,3,5" },
                    { "label": "j) 133 :", "id": "ex1_133", "answer": "7", "placeholder": "ex: 2,3,5" },
                    { "label": "k) 103 :", "id": "ex1_103", "answer": "aucun", "placeholder": "ex: 2,3,5" },
                    { "label": "l) 148 :", "id": "ex1_148b", "answer": "2,4", "placeholder": "ex: 2,3,5" },
                    { "label": "m) 232 :", "id": "ex1_232", "answer": "2,4,8", "placeholder": "ex: 2,3,5" },
                    { "label": "n) 119 :", "id": "ex1_119", "answer": "7", "placeholder": "ex: 2,3,5" },
                    { "label": "o) 195 :", "id": "ex1_195", "answer": "3,5,13,15", "placeholder": "ex: 2,3,5" },
                    { "label": "p) 155 :", "id": "ex1_155", "answer": "5", "placeholder": "ex: 2,3,5" }
                ],
                "solution": "Solutions:\na) 149: Aucun diviseur (nombre premier)\nb) 184: Divisible par 2, 4, 8\nc) 205: Divisible par 5\nd) 148: Divisible par 2, 4\ne) 272: Divisible par 2, 4, 8\nf) 264: Divisible par 2, 3, 4, 6, 8, 11, 12\ng) 121: Divisible par 11\nh) 275: Divisible par 5, 11\ni) 208: Divisible par 2, 4, 8, 13\nj) 133: Divisible par 7\nk) 103: Aucun diviseur (nombre premier)\nl) 148: Divisible par 2, 4\nm) 232: Divisible par 2, 4, 8\nn) 119: Divisible par 7\no) 195: Divisible par 3, 5, 13, 15\np) 155: Divisible par 5"
            },
            {
                "id": 2,
                "title": "Pourquoi la r√®gle pour la divisibilit√© par 9 ?",
                "icon": "ü§î",
                "type": "textarea",
                "description": "Exercice difficile pour les int√©ress√©s : pourquoi la r√®gle pour la divisibilit√© par 3 respectivement par 9 fonctionne-t-elle ? Essayez de l'expliquer.",
                "hint": "Conseil : pensez, p. ex. que 123 = 1 √ó 100 + 2 √ó 10 + 3.",
                "minLength": 50,
                "solution": "Solution:\nSi on d√©veloppe les parenth√®ses, les produits 1 √ó 99 et 2 √ó 9 sont forc√©ment divisibles par 9 resp. 3. Il reste donc seulement la somme 1 + 2 + 3 qui est la somme des chiffres.\n\nExplication d√©taill√©e:\n123 = 1 √ó 100 + 2 √ó 10 + 3 = 1 √ó (99 + 1) + 2 √ó (9 + 1) + 3\n= 1 √ó 99 + 1 + 2 √ó 9 + 2 + 3 = (1 √ó 99 + 2 √ó 9) + (1 + 2 + 3)"
            },
            {
                "id": 3,
                "title": "Calculs mentaux avec priorit√©s",
                "icon": "üß†",
                "type": "grid_input",
                "description": "Calculez mentalement en tenant compte de la priorit√© des op√©rations :",
                "questions": [
                    { "label": "a) 10 + 9 ‚àí [8 ‚àí (7 ‚àí 6)]", "id": "ex3_a", "answer": 12, "type": "number" },
                    { "label": "b) (12 + 8) ‚àí (15 ‚àí 7)", "id": "ex3_b", "answer": 12, "type": "number" },
                    { "label": "c) [1 + (4 ‚àí 2)] ‚àí [5 ‚àí (3 + 1)]", "id": "ex3_c", "answer": 2, "type": "number" },
                    { "label": "d) 28 ‚àí 12 + (14 ‚àí 8)", "id": "ex3_d", "answer": 22, "type": "number" },
                    { "label": "e) 15 + (16 ‚àí 6) ‚àí 8", "id": "ex3_e", "answer": 17, "type": "number" },
                    { "label": "f) 13 + [(14 + 15) ‚àí (16 + 12)]", "id": "ex3_f", "answer": 14, "type": "number" },
                    { "label": "g) 18 ‚àí [12 ‚àí (2 + 4)] ‚àí 4", "id": "ex3_g", "answer": 8, "type": "number" },
                    { "label": "h) 45 ‚àí (17 + 8) + 20", "id": "ex3_h", "answer": 40, "type": "number" },
                    { "label": "i) 21 ‚àí [49 ‚àí (40 + 2)]", "id": "ex3_i", "answer": 14, "type": "number" },
                    { "label": "j) 36 + (18 ‚àí 16 ‚àí 2)", "id": "ex3_j", "answer": 36, "type": "number" }
                ],
                "solution": "Solutions d√©taill√©es:\na) 10 + 9 - [8 - (7 - 6)] = 10 + 9 - [8 - 1] = 10 + 9 - 7 = 12\nb) (12 + 8) - (15 - 7) = 20 - 8 = 12\nc) [1 + (4 - 2)] - [5 - (3 + 1)] = [1 + 2] - [5 - 4] = 3 - 1 = 2\nd) 28 - 12 + (14 - 8) = 28 - 12 + 6 = 22\ne) 15 + (16 - 6) - 8 = 15 + 10 - 8 = 17\nf) 13 + [(14 + 15) - (16 + 12)] = 13 + [29 - 28] = 13 + 1 = 14\ng) 18 - [12 - (2 + 4)] - 4 = 18 - [12 - 6] - 4 = 18 - 6 - 4 = 8\nh) 45 - (17 + 8) + 20 = 45 - 25 + 20 = 40\ni) 21 - [49 - (40 + 2)] = 21 - [49 - 42] = 21 - 7 = 14\nj) 36 + (18 - 16 - 2) = 36 + 0 = 36"
            },
            {
                "id": 4,
                "title": "Parenth√®ses pour calculs corrects",
                "icon": "üìê",
                "type": "grid_input",
                "description": "Mettez des parenth√®ses sur les calculs suivants afin que le r√©sultat soit correct :",
                "questions": [
                    { "label": "a) 6 ‚àí 5 √ó 7 + 3 = 10", "id": "ex4_a", "answer": "(6 ‚àí 5) √ó (7 + 3) = 10", "placeholder": "Placez les parenth√®ses" },
                    { "label": "b) 6 ‚àí 5 √ó 7 + 3 = ‚àí32", "id": "ex4_b", "answer": "6 ‚àí (5 √ó 7 + 3) = ‚àí32", "placeholder": "Placez les parenth√®ses" },
                    { "label": "c) 3 + 8 ‚àí 7 √ó 5 = 20", "id": "ex4_c", "answer": "(3 + 8 ‚àí 7) √ó 5 = 20", "placeholder": "Placez les parenth√®ses" },
                    { "label": "d) 3 + 8 ‚àí 7 √ó 5 = 8", "id": "ex4_d", "answer": "3 + (8 ‚àí 7) √ó 5 = 8", "placeholder": "Placez les parenth√®ses" },
                    { "label": "e) 12 √ó 3 + 1 √ó 5 + 6 √ó 4 = 264", "id": "ex4_e", "answer": "12 √ó (3 + 1) √ó 5 + 6 √ó 4 = 264", "placeholder": "Placez les parenth√®ses" },
                    { "label": "f) 12 √ó 3 + 1 √ó 5 + 6 √ó 4 = 92", "id": "ex4_f", "answer": "12 √ó (3 + 1) √ó (5 + 6) √∑ 4 = 92", "placeholder": "Placez les parenth√®ses" },
                    { "label": "g) 23 ‚àí 2 + 1 √ó 5 √ó 2 ‚àí 1 = 8", "id": "ex4_g", "answer": "(23 ‚àí 2 + 1) √ó 5 √ó (2 ‚àí 1) = 8", "placeholder": "Placez les parenth√®ses" },
                    { "label": "h) 23 ‚àí 2 + 1 √ó 5 √ó 2 ‚àí 1 = ‚àí8", "id": "ex4_h", "answer": "23 ‚àí (2 + 1) √ó 5 √ó 2 ‚àí 1 = ‚àí8", "placeholder": "Placez les parenth√®ses" },
                    { "label": "i) 14 ‚àí 3 + 5 √ó 6 = 36", "id": "ex4_i", "answer": "(14 ‚àí 3 + 5) √ó 6 = 36", "placeholder": "Placez les parenth√®ses" },
                    { "label": "j) 14 ‚àí 3 + 5 √ó 6 = ‚àí34", "id": "ex4_j", "answer": "14 ‚àí (3 + 5) √ó 6 = ‚àí34", "placeholder": "Placez les parenth√®ses" }
                ],
                "solution": "Solutions:\na) (6 - 5) ¬∑ (7 + 3) = 1 ¬∑ 10 = 10\nb) 6 - (5 ¬∑ 7 + 3) = 6 - (35 + 3) = 6 - 38 = -32\nc) (3 + 8 - 7) ¬∑ 5 = 4 ¬∑ 5 = 20\nd) 3 + (8 - 7) ¬∑ 5 = 3 + 1 ¬∑ 5 = 3 + 5 = 8\ne) 12 ¬∑ (3 + 1) ¬∑ 5 + 6 ¬∑ 4 = 12 ¬∑ 4 ¬∑ 5 + 24 = 240 + 24 = 264\nf) 12 ¬∑ (3 + 1) ¬∑ (5 + 6) : 4 = 12 ¬∑ 4 ¬∑ 11 : 4 = 12 ¬∑ 11 = 132 ‚â† 92\ng) (23 - 2 + 1) ¬∑ 5 ¬∑ (2 - 1) = 22 ¬∑ 5 ¬∑ 1 ‚â† 8\nh) 23 - (2 + 1) ¬∑ 5 ¬∑ 2 - 1 = 23 - 3 ¬∑ 5 ¬∑ 2 - 1 = 23 - 30 - 1 = -8\ni) (14 - 3 + 5) ¬∑ 6 = 16 ¬∑ 6 ‚â† 36\nj) 14 - (3 + 5) ¬∑ 6 = 14 - 8 ¬∑ 6 = 14 - 48 = -34"
            },
            {
                "id": 5,
                "title": "Combinaisons avec 1, 3, 5, 7, 9",
                "icon": "üî¢",
                "type": "textarea",
                "description": "On vous donne les chiffres 1, 3, 5, 7 et 9 dans l'ordre. Combinez ces chiffres moyennant les op√©rations de base et des parenth√®ses afin d'obtenir les r√©sultats de 0 √† 9. L'ordre des chiffres doit √™tre maintenu. Notez qu'il y a parfois plusieurs possibilit√©s.",
                "minLength": 100,
                "solution": "Exemples de solutions:\n0 = 1 + 3 ¬∑ 5 - 7 - 9\n1 = 1 + 3 - 5 - 7 + 9\n2 = 1 - 3 ¬∑ 5 + 7 + 9\n3 = ((1 + 3) ¬∑ 5 + 7) : 9\n4 = 1 ¬∑ 3(5 + 7) : 9\n5 = 1 - 3 + 5 - 7 + 9\n6 = 1 ¬∑ 3 + 5 + 7 - 9\n7 = 1 + 3 + 5 + 7 - 9\n8 = (1 - 3 - 5) : 7 + 9\n9 = 1 - 3 - 5 + 7 + 9"
            },
            {
                "id": 6,
                "title": "Combinaisons avec 1, 2, 3, 4",
                "icon": "üî¢",
                "type": "textarea",
                "description": "On vous donne les chiffres de 1 √† 4 dans l'ordre. Combinez ces chiffres moyennant les op√©rations de base et des parenth√®ses afin d'obtenir les r√©sultats de 0 √† 9. L'ordre des chiffres doit √™tre maintenu. Notez qu'il y a parfois plusieurs possibilit√©s.",
                "minLength": 100,
                "solution": "Exemples de solutions:\n0 = (1 + 2 - 3) ¬∑ 4\n1 = (1 - 2) ¬∑ (3 - 4)\n2 = -(1 - 2) - (3 - 4)\n3 = 1 ¬∑ 2 - (3 - 4)\n4 = 1 + 2 - (3 - 4)\n5 = (1 + 2) ¬∑ 3 - 4\n6 = 1 - (2 - 3) + 4\n7 = -(1 - 2) ¬∑ 3 + 4\n8 = -(1 - 2 - 3) + 4\n9 = 1 ¬∑ 2 + 3 + 4"
            },
            {
                "id": 7,
                "title": "Calculs avec calculatrice - Arrondissement",
                "icon": "üßÆ",
                "type": "grid_input",
                "description": "Calculez avec la calculatrice. Donnez le r√©sultat en arrondissant √† 2 et 4 chiffres apr√®s la virgule :",
                "questions": [
                    { "label": "a) 3 √ó 4 - (2 √ó 4 √∑ 2 - 3) + 7 √∑ 5 √ó 2 - 3 √∑ 7 (2 chiffres)", "id": "ex7_a_2", "answer": "13.37", "placeholder": "ex: 12.34" },
                    { "label": "a) 3 √ó 4 - (2 √ó 4 √∑ 2 - 3) + 7 √∑ 5 √ó 2 - 3 √∑ 7 (4 chiffres)", "id": "ex7_a_4", "answer": "13.3714", "placeholder": "ex: 12.3456" },
                    { "label": "b) 3 √ó (‚Öî + ‚Öò) - 4 √ó 3 - (2 - 1) √∑ 4 (2 chiffres)", "id": "ex7_b_2", "answer": "-7.85", "placeholder": "ex: 12.34" },
                    { "label": "b) 3 √ó (‚Öî + ‚Öò) - 4 √ó 3 - (2 - 1) √∑ 4 (4 chiffres)", "id": "ex7_b_4", "answer": "-7.8500", "placeholder": "ex: 12.3456" },
                    { "label": "c) 4 √ó 7/6 - (¬æ - ‚Öò) √ó 0.512 (2 chiffres)", "id": "ex7_c_2", "answer": "4.69", "placeholder": "ex: 12.34" },
                    { "label": "c) 4 √ó 7/6 - (¬æ - ‚Öò) √ó 0.512 (4 chiffres)", "id": "ex7_c_4", "answer": "4.6923", "placeholder": "ex: 12.3456" },
                    { "label": "d) œÄ - ‚Öì + 3/7 - 3 (2 chiffres)", "id": "ex7_d_2", "answer": "0.15", "placeholder": "ex: 12.34" },
                    { "label": "d) œÄ - ‚Öì + 3/7 - 3 (4 chiffres)", "id": "ex7_d_4", "answer": "0.1511", "placeholder": "ex: 12.3456" },
                    { "label": "e) 2.31 + 1.324 √∑ 4.221 - 32/35 (2 chiffres)", "id": "ex7_e_2", "answer": "1.71", "placeholder": "ex: 12.34" },
                    { "label": "e) 2.31 + 1.324 √∑ 4.221 - 32/35 (4 chiffres)", "id": "ex7_e_4", "answer": "1.7094", "placeholder": "ex: 12.3456" },
                    { "label": "f) 0.54 √ó (7/3 - ‚Öï) √∑ 0.134 (2 chiffres)", "id": "ex7_f_2", "answer": "8.65", "placeholder": "ex: 12.34" },
                    { "label": "f) 0.54 √ó (7/3 - ‚Öï) √∑ 0.134 (4 chiffres)", "id": "ex7_f_4", "answer": "8.6493", "placeholder": "ex: 12.3456" }
                ],
                "solution": "Solutions:\na) 13.37 resp. 13.3714\nb) -7.85 resp. -7.8500\nc) 4.69 resp. 4.6923\nd) 0.15 resp. 0.1511\ne) 1.71 resp. 1.7094\nf) 8.65 resp. 8.6493"
            },
            {
                "id": 8,
                "title": "Calculs avec enregistrement",
                "icon": "üíæ",
                "type": "grid_input",
                "description": "Faites d'abord les trois calculs suivants et enregistrez les r√©sultats. Calculez ensuite √† 3 chiffres apr√®s la virgule :",
                "questions": [
                    { "label": "Calcul 1: 3 √ó 2 ‚àí (4 √ó 4 √∑ 2 ‚àí 3) √ó 3 √∑ 7", "id": "ex8_calc1", "answer": "7.736", "type": "text" },
                    { "label": "Calcul 2: 3 √ó (‚Öî + ‚Öò) ‚àí 4 √ó (2 ‚àí 1)", "id": "ex8_calc2", "answer": "5.367", "type": "text" },
                    { "label": "Calcul 3: 4 √ó 9/7 ‚àí (¬æ ‚àí ‚Öò)", "id": "ex8_calc3", "answer": "1.224", "type": "text" },
                    { "label": "a) La somme des trois =", "id": "ex8_a", "answer": "14.327", "type": "text" },
                    { "label": "b) Le produit des trois =", "id": "ex8_b", "answer": "50.876", "type": "text" },
                    { "label": "c) La somme des deux premiers, divis√©e par le troisi√®me =", "id": "ex8_c", "answer": "10.701", "type": "text" },
                    { "label": "d) La somme des deux derniers, moins le premier =", "id": "ex8_d", "answer": "-1.145", "type": "text" }
                ],
                "solution": "Solutions:\nCalcul 1: 7.736\nCalcul 2: 5.367\nCalcul 3: 1.224\na) 7.736 + 5.367 + 1.224 = 14.327\nb) 7.736 √ó 5.367 √ó 1.224 = 50.876\nc) (7.736 + 5.367) √∑ 1.224 = 10.701\nd) (5.367 + 1.224) - 7.736 = -1.145"
            },
            {
                "id": 9,
                "title": "Nombres premiers",
                "icon": "üî¢",
                "type": "grid_input",
                "description": "Parmi les nombres suivants, lesquels sont des nombres premiers ? Calculez sans calculatrice. Astuce : 16¬≤ = 256, 17¬≤ = 289 et 18¬≤ = 324.",
                "questions": [
                    { "label": "a) 153", "id": "ex9_153", "answer": "non", "placeholder": "oui/non" },
                    { "label": "b) 179", "id": "ex9_179", "answer": "oui", "placeholder": "oui/non" },
                    { "label": "c) 161", "id": "ex9_161", "answer": "non", "placeholder": "oui/non" },
                    { "label": "d) 221", "id": "ex9_221", "answer": "non", "placeholder": "oui/non" },
                    { "label": "e) 159", "id": "ex9_159", "answer": "non", "placeholder": "oui/non" },
                    { "label": "f) 163", "id": "ex9_163", "answer": "oui", "placeholder": "oui/non" },
                    { "label": "g) 217", "id": "ex9_217", "answer": "non", "placeholder": "oui/non" },
                    { "label": "h) 116", "id": "ex9_116", "answer": "non", "placeholder": "oui/non" },
                    { "label": "i) 265", "id": "ex9_265", "answer": "non", "placeholder": "oui/non" },
                    { "label": "j) 186", "id": "ex9_186", "answer": "non", "placeholder": "oui/non" },
                    { "label": "k) 173", "id": "ex9_173", "answer": "oui", "placeholder": "oui/non" },
                    { "label": "l) 273", "id": "ex9_273", "answer": "non", "placeholder": "oui/non" },
                    { "label": "m) 291", "id": "ex9_291", "answer": "non", "placeholder": "oui/non" },
                    { "label": "n) 223", "id": "ex9_223", "answer": "oui", "placeholder": "oui/non" },
                    { "label": "o) 271", "id": "ex9_271", "answer": "oui", "placeholder": "oui/non" },
                    { "label": "p) 123", "id": "ex9_123", "answer": "non", "placeholder": "oui/non" }
                ],
                "solution": "Nombres premiers: 179, 163, 173, 223 et 271.\n\nV√©rifications:\n- 153 = 3¬≤ √ó 17 (pas premier)\n- 179 est premier ‚úì\n- 161 = 7 √ó 23 (pas premier)\n- 221 = 13 √ó 17 (pas premier)\n- 159 = 3 √ó 53 (pas premier)\n- 163 est premier ‚úì\n- 217 = 7 √ó 31 (pas premier)\n- 116 = 4 √ó 29 (pas premier)\n- 265 = 5 √ó 53 (pas premier)\n- 186 = 2 √ó 3 √ó 31 (pas premier)\n- 173 est premier ‚úì\n- 273 = 3 √ó 7 √ó 13 (pas premier)\n- 291 = 3 √ó 97 (pas premier)\n- 223 est premier ‚úì\n- 271 est premier ‚úì\n- 123 = 3 √ó 41 (pas premier)"
            },
            {
                "id": 10,
                "title": "D√©composition en facteurs premiers",
                "icon": "üîç",
                "type": "grid_input",
                "description": "D√©composez les nombres suivants en facteurs premiers et √©crivez-les dans leur forme normale :",
                "questions": [
                    { "label": "a) 12", "id": "ex10_a", "answer": "2¬≤ √ó 3", "placeholder": "ex: 2¬≥ √ó 5" },
                    { "label": "b) 16", "id": "ex10_b", "answer": "2‚Å¥", "placeholder": "ex: 2¬≥ √ó 5" },
                    { "label": "c) 18", "id": "ex10_c", "answer": "2 √ó 3¬≤", "placeholder": "ex: 2¬≥ √ó 5" },
                    { "label": "d) 26", "id": "ex10_d", "answer": "2 √ó 13", "placeholder": "ex: 2¬≥ √ó 5" },
                    { "label": "e) 38", "id": "ex10_e", "answer": "2 √ó 19", "placeholder": "ex: 2¬≥ √ó 5" },
                    { "label": "f) 46", "id": "ex10_f", "answer": "2 √ó 23", "placeholder": "ex: 2¬≥ √ó 5" },
                    { "label": "g) 56", "id": "ex10_g", "answer": "2¬≥ √ó 7", "placeholder": "ex: 2¬≥ √ó 5" },
                    { "label": "h) 88", "id": "ex10_h", "answer": "2¬≥ √ó 11", "placeholder": "ex: 2¬≥ √ó 5" },
                    { "label": "i) 124", "id": "ex10_i", "answer": "2¬≤ √ó 31", "placeholder": "ex: 2¬≥ √ó 5" },
                    { "label": "j) 218", "id": "ex10_j", "answer": "2 √ó 109", "placeholder": "ex: 2¬≥ √ó 5" },
                    { "label": "k) 312", "id": "ex10_k", "answer": "2¬≥ √ó 3 √ó 13", "placeholder": "ex: 2¬≥ √ó 5" },
                    { "label": "l) 432", "id": "ex10_l", "answer": "2‚Å¥ √ó 3¬≥", "placeholder": "ex: 2¬≥ √ó 5" }
                ],
                "solution": "Solutions:\na) 12 = 2¬≤ √ó 3\nb) 16 = 2‚Å¥\nc) 18 = 2 √ó 3¬≤\nd) 26 = 2 √ó 13\ne) 38 = 2 √ó 19\nf) 46 = 2 √ó 23\ng) 56 = 2¬≥ √ó 7\nh) 88 = 2¬≥ √ó 11\ni) 124 = 2¬≤ √ó 31\nj) 218 = 2 √ó 109\nk) 312 = 2¬≥ √ó 3 √ó 13\nl) 432 = 2‚Å¥ √ó 3¬≥"
            },
            {
                "id": 11,
                "title": "Diviseur commun",
                "icon": "üîó",
                "type": "single_input",
                "description": "Les nombres 56, 88 et 124 ont-ils un diviseur commun ? Si oui, lequel ? Argumentez gr√¢ce √† la d√©composition en facteurs premiers. Pour ce faire, vous pouvez laisser de c√¥t√© le 1.",
                "questions": [
                    { "label": "Diviseur commun :", "id": "ex11_answer", "answer": "4", "type": "number" }
                ],
                "solution": "Solution: Oui, les trois sont divisibles par 4, et donc aussi par 2.\n\n56 = 2¬≥ ¬∑ 7\n88 = 2¬≥ ¬∑ 11\n124 = 2¬≤ ¬∑ 31\n\nLe facteur commun est 2¬≤, donc le diviseur commun est 4."
            },
            {
                "id": 12,
                "title": "Plus Petit Multiple Commun (PPMC)",
                "icon": "üìä",
                "type": "grid_input",
                "description": "D√©terminez le PPMC des nombres suivants sans calculatrice :",
                "questions": [
                    { "label": "a) PPMC(4, 7, 12) =", "id": "ex12_a", "answer": 84, "type": "number" },
                    { "label": "b) PPMC(3, 10, 13) =", "id": "ex12_b", "answer": 390, "type": "number" },
                    { "label": "c) PPMC(5, 9, 14) =", "id": "ex12_c", "answer": 630, "type": "number" },
                    { "label": "d) PPMC(20, 32, 56) =", "id": "ex12_d", "answer": 1120, "type": "number" },
                    { "label": "e) PPMC(24, 60, 125) =", "id": "ex12_e", "answer": 3000, "type": "number" },
                    { "label": "f) PPMC(128, 150, 180, 220) =", "id": "ex12_f", "answer": 316800, "type": "number" }
                ],
                "solution": "Solutions:\na) PPMC(4,7,12) = 84\nb) PPMC(3,10,13) = 390\nc) PPMC(5,9,14) = 630\nd) PPMC(20,32,56) = 1120\ne) PPMC(24,60,125) = 3000\nf) PPMC(128,150,180,220) = 316800"
            },
            {
                "id": 13,
                "title": "PPMC - Exercices suppl√©mentaires",
                "icon": "üìà",
                "type": "grid_input",
                "description": "D√©terminez ici aussi le PPMC :",
                "questions": [
                    { "label": "a) PPMC(35, 8, 15) =", "id": "ex13_a", "answer": 840, "type": "number" },
                    { "label": "b) PPMC(26, 48, 10) =", "id": "ex13_b", "answer": 3120, "type": "number" },
                    { "label": "c) PPMC(64, 8, 24) =", "id": "ex13_c", "answer": 192, "type": "number" },
                    { "label": "d) PPMC(82, 15, 25) =", "id": "ex13_d", "answer": 6150, "type": "number" },
                    { "label": "e) PPMC(91, 28, 65) =", "id": "ex13_e", "answer": 1820, "type": "number" },
                    { "label": "f) PPMC(108, 24, 56) =", "id": "ex13_f", "answer": 1512, "type": "number" }
                ],
                "solution": "Solutions:\na) PPMC(35,8,15) = 840\nb) PPMC(26,48,10) = 3120\nc) PPMC(64,8,24) = 192\nd) PPMC(82,15,25) = 6150\ne) PPMC(91,28,65) = 1820\nf) PPMC(108,24,56) = 1512"
            },
            {
                "id": 14,
                "title": "Famille Bachmann",
                "icon": "üö∂",
                "type": "single_input",
                "description": "La famille Bachmann part en promenade. Le p√®re a une longueur de pas de 90 cm, et son fils de 65 cm. Le chien laisse son empreinte par terre tous les 25 cm. Apr√®s quelle distance aura-t-on les empreintes de deux pieds et d'une patte √† la m√™me hauteur ?",
                "questions": [
                    { "label": "Distance (en cm) :", "id": "ex14_distance", "answer": 5850, "type": "number" }
                ],
                "solution": "Solution: 5850 cm (58.5 m)\n\nCalcul:\nIl faut trouver le PPMC de 90, 65 et 25.\n90 = 2 √ó 3¬≤ √ó 5\n65 = 5 √ó 13\n25 = 5¬≤\n\nPPMC(90,65,25) = 2 √ó 3¬≤ √ó 5¬≤ √ó 13 = 2 √ó 9 √ó 25 √ó 13 = 5850 cm"
            },
            {
                "id": 15,
                "title": "Patricia et St√©phanie √† v√©lo",
                "icon": "üö¥",
                "type": "single_input",
                "description": "Patricia et St√©phanie partent se balader √† v√©lo. La roue avant de Patricia est un peu voil√©e tant et si bien que l'on entend deux bruits √† chaque fois que sa roue fait un tour. Le v√©lo de St√©phanie fait aussi du bruit : il cliquette une fois √† chaque tour. La roue de Patricia fait 20 tours par minute et celle de St√©phanie 24. Combien de secondes faut-il pour que le bruit des deux roues se fasse au m√™me moment ?",
                "questions": [
                    { "label": "Temps (en secondes) :", "id": "ex15_time", "answer": 7.5, "type": "number" }
                ],
                "solution": "Solution: 7.5 secondes\n\nCalcul:\nPatricia: 20 tours/min = 40 bruits/min (2 bruits par tour)\nSt√©phanie: 24 tours/min = 24 bruits/min\n\nPPMC(40, 24) = 120 bruits/min\n120 bruits correspondent √† 1 minute = 60 secondes\n1 bruit correspond √† 60/120 = 0.5 seconde\n\nLe premier bruit simultan√© apr√®s le d√©part : 7.5 secondes"
            },
            {
                "id": 16,
                "title": "Gobelets de jus d'orange",
                "icon": "ü•§",
                "type": "single_input",
                "description": "Une certaine quantit√© de jus d'orange doit √™tre mise dans des gobelets. Si l'on utilise des gobelets de 3 dl, il restera 1 dl √† la fin. Si par contre on utilise des gobelets de 5 dl, il restera 2 dl. Avec des gobelets de 4 dl, il restera √©galement un surplus de 1 dl. Combien y a-t-il de jus d'orange, sachant qu'il y en a plus de 5, mais moins de 10 litres ?",
                "questions": [
                    { "label": "Quantit√© de jus (en dl) :", "id": "ex16_quantity", "answer": 97, "type": "number" }
                ],
                "solution": "Solution: 97 dl\n\nCalcul:\n- D√©terminer le PPMC de 3 dl et de 4 dl : 12 dl\n- puis inclure le 1 dl restant : 13 dl\n- les quantit√©s possibles sont donc : 61 dl, 73 dl, 85 dl et 97 dl\n- parmi ces quantit√©s, seule 97 dl donne le reste souhait√© avec des gobelets de 5 dl"
            },
            {
                "id": 17,
                "title": "Rayon laser et disques",
                "icon": "üíø",
                "type": "single_input",
                "description": "Un rayon laser est projet√© contre un √©cran de projection. Il y a deux disques entre le projecteur et l'√©cran. Le disque A a un trou et tourne cinq fois par minute. Le disque B a deux trous juxtapos√©s et tourne 1.25 fois plus vite. Le rayon laser n'est visible sur l'√©cran de projection que si les trous des deux disques sont align√©s. Combien de fois est-ce le cas en 10 minutes ?",
                "questions": [
                    { "label": "Nombre de fois :", "id": "ex17_count", "answer": 25, "type": "number" }
                ],
                "solution": "Solution: 25 fois\n\nCalcul:\nLe disque A laisse passer le rayon toutes les 12 s, le disque B toutes les 4.8 s.\nEn tout, le rayon passe √† travers les deux disques toutes les 24 s, donc 25 fois en 10 min."
            },
            {
                "id": 18,
                "title": "Plus Grand Diviseur Commun (PGDC)",
                "icon": "üîΩ",
                "type": "grid_input",
                "description": "D√©terminez le PGDC des nombres suivants sans utiliser la calculatrice :",
                "questions": [
                    { "label": "a) PGDC(4, 7, 12) =", "id": "ex18_a", "answer": 1, "type": "number" },
                    { "label": "b) PGDC(3, 10, 13) =", "id": "ex18_b", "answer": 1, "type": "number" },
                    { "label": "c) PGDC(5, 9, 14) =", "id": "ex18_c", "answer": 1, "type": "number" },
                    { "label": "d) PGDC(20, 32, 56) =", "id": "ex18_d", "answer": 4, "type": "number" },
                    { "label": "e) PGDC(24, 60, 125) =", "id": "ex18_e", "answer": 1, "type": "number" },
                    { "label": "f) PGDC(128, 150, 180, 220) =", "id": "ex18_f", "answer": 2, "type": "number" }
                ],
                "solution": "Solutions:\na) PGDC(4,7,12) = 1\nb) PGDC(3,10,13) = 1\nc) PGDC(5,9,14) = 1\nd) PGDC(20,32,56) = 4\ne) PGDC(24,60,125) = 1\nf) PGDC(128,150,180,220) = 2"
            },
            {
                "id": 19,
                "title": "Bassin et carrelages",
                "icon": "üèä",
                "type": "single_input",
                "description": "Un bassin fait 8.1 m de long, 4.5 m de large et 1.8 m de profondeur. Les parois doivent √™tre recouvertes de carrelages carr√©s. Quelle est la grandeur maximale de l'un de ces carrelages si aucun d'entre eux ne doit √™tre d√©coup√© ?",
                "questions": [
                    { "label": "Taille du carrelage (en m) :", "id": "ex19_size", "answer": 0.9, "type": "number" }
                ],
                "solution": "Solution: 0.9 m\n\nCalcul:\nDimensions en dm: 81 dm √ó 45 dm √ó 18 dm\nPGDC(81, 45, 18) = 9 dm = 0.9 m"
            }
        ]
    };

    /**
     * Syst√®me math√©matique hybride
     */
    class HybridMathInputSystem {
        constructor() {
            this.activeInput = null;
            this.palette = null;
            this.createPalette();
            this.bindEvents();
        }
        
        createPalette() {
            this.palette = document.createElement('div');
            this.palette.className = 'math-palette';
            this.palette.innerHTML = `
                <button class="symbol-btn" data-symbol="+">+</button>
                <button class="symbol-btn" data-symbol="‚àí">‚àí</button>
                <button class="symbol-btn" data-symbol="√ó">√ó</button>
                <button class="symbol-btn" data-symbol="√∑">√∑</button>
                <button class="symbol-btn" data-symbol="(">(</button>
                <button class="symbol-btn" data-symbol=")">)</button>
                <button class="symbol-btn" data-symbol="œÄ">œÄ</button>
                <button class="symbol-btn" data-symbol="¬≤">¬≤</button>
                <button class="symbol-btn" data-symbol="¬≥">¬≥</button>
                <button class="symbol-btn" data-symbol="‚Å¥">‚Å¥</button>
            `;
            document.body.appendChild(this.palette);
        }
        
        bindEvents() {
            document.addEventListener('focusin', (e) => {
                if (e.target.classList.contains('math-input')) {
                    this.showPalette(e.target);
                }
            });
            
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('symbol-btn')) {
                    e.preventDefault();
                    this.insertSymbol(e.target.dataset.symbol);
                } else if (!e.target.closest('.math-palette') && !e.target.classList.contains('math-input')) {
                    this.hidePalette();
                }
            });
            
            document.addEventListener('input', (e) => {
                if (e.target.classList.contains('math-input')) {
                    setTimeout(() => this.handleAutoConversion(e.target), 10);
                }
            });
        }
        
        showPalette(input) {
            this.activeInput = input;
            const rect = input.getBoundingClientRect();
            this.palette.style.top = (rect.bottom + window.scrollY + 5) + 'px';
            this.palette.style.left = rect.left + 'px';
            this.palette.classList.add('active');
        }
        
        hidePalette() {
            this.palette.classList.remove('active');
        }
        
        insertSymbol(symbol) {
            if (!this.activeInput) return;
            
            const selection = window.getSelection();
            const range = selection.rangeCount > 0 ? selection.getRangeAt(0) : null;
            
            if (range) {
                range.deleteContents();
                range.insertNode(document.createTextNode(symbol));
                range.collapse(false);
                selection.removeAllRanges();
                selection.addRange(range);
            }
        }
        
        handleAutoConversion(input) {
            let content = input.textContent || '';
            let converted = content;
            
            // Conversion des fractions
            converted = converted.replace(/(-?\d+(?:\.\d+)?)\/(-?\d+(?:\.\d+)?)/g, (match, num, den) => {
                return `<span class="fraction"><span class="numerator">${num}</span><span class="denominator">${den}</span></span>`;
            });
            
            // Fractions complexes avec parenth√®ses
            converted = converted.replace(/\(([^)]+)\)\/\(([^)]+)\)/g, (match, num, den) => {
                return `<span class="fraction"><span class="numerator">${num}</span><span class="denominator">${den}</span></span>`;
            });
            
            if (converted !== content) {
                const selection = window.getSelection();
                const range = selection.rangeCount > 0 ? selection.getRangeAt(0) : null;
                const cursorOffset = range ? range.startOffset : content.length;
                
                input.innerHTML = converted;
                
                // Restaurer le curseur
                try {
                    const newRange = document.createRange();
                    const textNodes = this.getTextNodes(input);
                    let currentOffset = 0;
                    
                    for (let node of textNodes) {
                        if (currentOffset + node.textContent.length >= cursorOffset) {
                            newRange.setStart(node, Math.min(cursorOffset - currentOffset, node.textContent.length));
                            newRange.setEnd(node, Math.min(cursorOffset - currentOffset, node.textContent.length));
                            break;
                        }
                        currentOffset += node.textContent.length;
                    }
                    
                    selection.removeAllRanges();
                    selection.addRange(newRange);
                } catch (e) {
                    // En cas d'erreur, placer le curseur √† la fin
                    const range = document.createRange();
                    range.selectNodeContents(input);
                    range.collapse(false);
                    selection.removeAllRanges();
                    selection.addRange(range);
                }
            }
        }
        
        getTextNodes(element) {
            const textNodes = [];
            const walker = document.createTreeWalker(
                element,
                NodeFilter.SHOW_TEXT,
                null,
                false
            );
            
            let node;
            while (node = walker.nextNode()) {
                textNodes.push(node);
            }
            
            return textNodes;
        }
        
        compareAnswers(userAnswer, correctAnswer) {
            const normalize = (answer) => {
                return answer.toLowerCase()
                    .replace(/\s+/g, '')
                    .replace(/√ó/g, '*')
                    .replace(/√∑/g, '/')
                    .replace(/‚àí/g, '-');
            };
            
            return normalize(userAnswer) === normalize(correctAnswer);
        }
        
        destroy() {
            if (this.palette) {
                this.palette.remove();
            }
        }
    }

    /**
     * Gestionnaire de chapitre complet
     */
    class ChapterManager {
        constructor() {
            this.currentChapter = null;
            this.completedExercises = 0;
            this.correctAnswers = 0;
            this.exerciseStates = new Map();
            this.hybridMathSystem = new HybridMathInputSystem();
            this.createHelpModal();
        }
        
        createHelpModal() {
            const modal = document.createElement('div');
            modal.id = 'math-help-modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Guide de saisie math√©matique</h3>
                        <button class="modal-close" onclick="chapterManager.closeHelpModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <p><strong>Conversion automatique :</strong> Tapez "/" pour cr√©er des fractions automatiquement.</p>
                        <p><strong>Palette :</strong> Cliquez dans un champ pour ouvrir la palette de symboles.</p>
                        <p><strong>Exemple :</strong> Tapez "3/4" et cela devient une fraction format√©e.</p>
                        <p><strong>Fractions complexes :</strong> Tapez "(2x+1)/(x-3)" pour des expressions complexes.</p>
                        <p><strong>Symboles disponibles :</strong> +, ‚àí, √ó, √∑, œÄ, ¬≤, ¬≥, ‚Å¥</p>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        showHelpModal() {
            document.getElementById('math-help-modal').style.display = 'flex';
        }
        
        closeHelpModal() {
            document.getElementById('math-help-modal').style.display = 'none';
        }
        
        loadChapter(data = chapterData) {
            this.currentChapter = data;
            this.initializePage(data);
        }
        
        initializePage(data) {
            this.updatePageMetadata(data);
            this.generateNavigation(data.sections);
            this.generateContent(data);
        }
        
        updatePageMetadata(data) {
            document.title = `${data.chapter.title} - Cours Interactif`;
            document.getElementById('chapter-title').textContent = `üìö ${data.chapter.number} ${data.chapter.title}`;
            document.getElementById('totalExercises').textContent = data.chapter.totalExercises;
            
            const quoteElement = document.getElementById('chapter-quote');
            if (data.chapter.quote) {
                quoteElement.innerHTML = `"${DOMSanitizer.sanitizeText(data.chapter.quote.text)}"<br><em>‚Äî ${DOMSanitizer.sanitizeText(data.chapter.quote.author)}</em>`;
            }
        }
        
        generateNavigation(sections) {
            const nav = document.getElementById('navigation');
            let navHTML = '<button class="nav-btn" onclick="chapterManager.showHelpModal()">‚ùì Aide</button>';
            
            sections.forEach(section => {
                navHTML += `<button class="nav-btn" onclick="document.getElementById('${section.id}').scrollIntoView({behavior: 'smooth'})">${section.icon} ${section.title}</button>`;
            });
            
            navHTML += '<button class="nav-btn" onclick="document.getElementById(\'exercices\').scrollIntoView({behavior: \'smooth\'})">üìù Exercices</button>';
            nav.innerHTML = navHTML;
        }
        
        generateContent(data) {
            const content = document.getElementById('dynamic-content');
            let contentHTML = '';
            
            // G√©n√©rer les sections
            data.sections.forEach(section => {
                contentHTML += this.generateSection(section);
            });
            
            // G√©n√©rer les exercices
            contentHTML += '<div class="section" id="exercices"><h2 class="section-title">üìù Exercices</h2>';
            
            data.exercises.forEach(exercise => {
                contentHTML += this.generateExercise(exercise);
            });
            
            contentHTML += '</div>';
            content.innerHTML = contentHTML;
        }
        
        generateSection(section) {
            let html = `<div class="section" id="${section.id}">
                <h2 class="section-title">${section.title}</h2>`;
            
            if (section.theory) {
                section.theory.forEach(item => {
                    html += this.generateTheoryItem(item);
                });
            }
            
            if (section.examples) {
                section.examples.forEach(example => {
                    html += `<div class="example-box">
                        <div class="example-title">${DOMSanitizer.sanitizeText(example.title)}</div>
                        <p>${DOMSanitizer.sanitizeText(example.content)}</p>
                    </div>`;
                });
            }
            
            if (section.subsections) {
                section.subsections.forEach(subsection => {
                    html += `<div class="subsection-title">${DOMSanitizer.sanitizeText(subsection.title)}</div>`;
                    if (subsection.content) {
                        subsection.content.forEach(item => {
                            html += this.generateTheoryItem(item);
                        });
                    }
                });
            }
            
            html += '</div>';
            return html;
        }
        
        generateTheoryItem(item) {
            switch (item.type) {
                case 'text':
                    return `<div class="theory-box"><p>${DOMSanitizer.sanitizeText(item.content)}</p></div>`;
                
                case 'table':
                    return this.generateTable(item);
                
                case 'ordered_list':
                    return this.generateOrderedList(item);
                
                case 'steps':
                    return this.generateSteps(item);
                
                default:
                    return `<div class="theory-box"><p>${DOMSanitizer.sanitizeText(item.content || '')}</p></div>`;
            }
        }
        
        generateTable(tableData) {
            let html = `<div class="theory-box">
                <table class="divisibility-table">
                    <thead><tr>`;
            
            tableData.headers.forEach(header => {
                html += `<th>${DOMSanitizer.sanitizeText(header)}</th>`;
            });
            
            html += `</tr></thead><tbody>`;
            
            tableData.data.forEach(row => {
                html += '<tr>';
                row.forEach(cell => {
                    html += `<td>${DOMSanitizer.sanitizeText(cell)}</td>`;
                });
                html += '</tr>';
            });
            
            html += '</tbody></table></div>';
            return html;
        }
        
        generateOrderedList(listData) {
            let html = `<div class="priority-list">
                <h3>${DOMSanitizer.sanitizeText(listData.title)}</h3>
                <ol>`;
            
            listData.items.forEach(item => {
                html += `<li><strong>${DOMSanitizer.sanitizeText(item)}</strong></li>`;
            });
            
            html += '</ol></div>';
            return html;
        }
        
        generateSteps(stepsData) {
            let html = `<div class="calculator-steps">`;
            
            if (stepsData.title) {
                html += `<h4>${DOMSanitizer.sanitizeText(stepsData.title)}</h4>`;
            }
            
            html += '<ol>';
            
            stepsData.items.forEach(step => {
                html += `<li>${DOMSanitizer.sanitizeText(step)}</li>`;
            });
            
            html += '</ol></div>';
            return html;
        }
        
        generateExercise(exercise) {
            let html = `<div class="exercise">
                <div class="exercise-title">${exercise.icon} Exercice ${exercise.id}: ${DOMSanitizer.sanitizeText(exercise.title)}</div>
                <div class="question">
                    <div class="question-text">${DOMSanitizer.sanitizeText(exercise.description)}</div>`;
            
            html += this.generateExerciseInputs(exercise);
            
            html += `
                <button class="btn btn-check" onclick="chapterManager.checkExercise(${exercise.id})">V√©rifier</button>
                <button class="btn btn-solution" onclick="chapterManager.showSolution(${exercise.id})">Solution</button>
                <button class="btn btn-reset" onclick="chapterManager.resetExercise(${exercise.id})">Reset</button>
                <div class="feedback" id="feedback${exercise.id}"></div>
            </div>
        </div>`;
            
            return html;
        }
        
        generateExerciseInputs(exercise) {
            let html = '';
            
            switch (exercise.type) {
                case 'grid_input':
                    html += '<div class="grid-answers">';
                    exercise.questions.forEach(q => {
                        const inputType = q.type === 'number' ? 'number' : 'text';
                        html += `<div>
                            <label><strong>${DOMSanitizer.sanitizeText(q.label)}</strong></label>
                            <div contenteditable="true" class="answer-input math-input" id="${q.id}" 
                                 data-placeholder="${DOMSanitizer.sanitizeText(q.placeholder || '')}" 
                                 data-input-type="${inputType}"></div>
                        </div>`;
                    });
                    html += '</div>';
                    break;
                    
                case 'single_input':
                    const q = exercise.questions[0];
                    const inputType = q.type === 'number' ? 'number' : 'text';
                    html += `<div>
                        <label><strong>${DOMSanitizer.sanitizeText(q.label)}</strong></label>
                        <div contenteditable="true" class="answer-input math-input" id="${q.id}" 
                             data-placeholder="${DOMSanitizer.sanitizeText(q.placeholder || '')}" 
                             data-input-type="${inputType}"></div>
                    </div>`;
                    break;
                    
                case 'textarea':
                    html += `<textarea class="answer-input" id="ex${exercise.id}_text" 
                        placeholder="${DOMSanitizer.sanitizeText(exercise.hint || '')}" 
                        style="width: 100%; height: 120px; resize: vertical;"></textarea>`;
                    break;
            }
            
            return html;
        }
        
        checkExercise(exerciseId) {
            const exercise = this.currentChapter.exercises.find(ex => ex.id === exerciseId);
            if (!exercise) return;

            let isCorrect = false;
            let feedback = '';
            let correctCount = 0;
            let totalQuestions = 0;

            switch (exercise.type) {
                case 'grid_input':
                case 'single_input':
                    totalQuestions = exercise.questions.length;
                    
                    exercise.questions.forEach(question => {
                        const element = document.getElementById(question.id);
                        const userAnswer = (element.textContent || element.innerText || '').trim();
                        const correctAnswer = question.answer.toString().trim();
                        
                        let isQuestionCorrect = false;
                        
                        if (question.type === 'number') {
                            const userNum = parseFloat(userAnswer);
                            const correctNum = parseFloat(correctAnswer);
                            if (!isNaN(userNum) && Math.abs(userNum - correctNum) < 0.001) {
                                correctCount++;
                                isQuestionCorrect = true;
                            }
                        } else {
                            if (this.hybridMathSystem.compareAnswers(userAnswer, correctAnswer)) {
                                correctCount++;
                                isQuestionCorrect = true;
                            }
                        }
                        
                        element.classList.remove('correct', 'incorrect');
                        element.classList.add(isQuestionCorrect ? 'correct' : 'incorrect');
                    });
                    
                    isCorrect = correctCount === totalQuestions;
                    feedback = totalQuestions === 1 ? 
                        (isCorrect ? 'Correct !' : 'Incorrect.') :
                        `${correctCount}/${totalQuestions} r√©ponses correctes`;
                    break;
                    
                case 'textarea':
                    const userText = document.getElementById(`ex${exerciseId}_text`).value.trim();
                    const minLength = exercise.minLength || 20;
                    isCorrect = userText.length >= minLength;
                    feedback = isCorrect ? 
                        'Explication fournie ! Consultez la solution pour comparer.' : 
                        `Veuillez fournir une explication plus d√©taill√©e (minimum ${minLength} caract√®res).`;
                    break;
            }

            this.showFeedback(exerciseId, feedback, isCorrect ? 'correct' : 'incorrect');
            this.updateExerciseState(exerciseId, isCorrect);
            this.updateStats();
        }
        
        showSolution(exerciseId) {
            const exercise = this.currentChapter.exercises.find(ex => ex.id === exerciseId);
            if (exercise && exercise.solution) {
                this.showFeedback(exerciseId, exercise.solution, 'solution');
            }
        }
        
        resetExercise(exerciseId) {
            const exercise = this.currentChapter.exercises.find(ex => ex.id === exerciseId);
            if (!exercise) return;

            switch (exercise.type) {
                case 'grid_input':
                case 'single_input':
                    exercise.questions.forEach(question => {
                        const element = document.getElementById(question.id);
                        if (element) {
                            element.innerHTML = '';
                            element.classList.remove('correct', 'incorrect');
                        }
                    });
                    break;
                    
                case 'textarea':
                    const element = document.getElementById(`ex${exerciseId}_text`);
                    if (element) {
                        element.value = '';
                        element.classList.remove('correct', 'incorrect');
                    }
                    break;
            }
            
            this.resetFeedback(exerciseId);
        }
        
        showFeedback(exerciseId, message, type) {
            const feedback = document.getElementById(`feedback${exerciseId}`);
            if (feedback) {
                feedback.textContent = message;
                feedback.className = `feedback ${type}`;
                feedback.style.display = 'block';
            }
        }
        
        resetFeedback(exerciseId) {
            const feedback = document.getElementById(`feedback${exerciseId}`);
            if (feedback) {
                feedback.style.display = 'none';
            }
        }
        
        updateExerciseState(exerciseId, isCorrect) {
            const wasCompleted = this.exerciseStates.has(exerciseId);
            const wasCorrect = this.exerciseStates.get(exerciseId);
            
            if (!wasCompleted) {
                this.completedExercises++;
                if (isCorrect) this.correctAnswers++;
            } else if (wasCorrect !== isCorrect) {
                this.correctAnswers += isCorrect ? 1 : -1;
            }
            
            this.exerciseStates.set(exerciseId, isCorrect);
        }
        
        updateStats() {
            const elements = {
                'completedExercises': this.completedExercises,
                'correctAnswers': this.correctAnswers
            };

            Object.entries(elements).forEach(([id, value]) => {
                const element = document.getElementById(id);
                if (element) element.textContent = value;
            });

            const totalExercises = this.currentChapter?.chapter?.totalExercises || 1;
            const progress = (this.completedExercises / totalExercises) * 100;
            const progressFill = document.getElementById('progressFill');
            if (progressFill) {
                progressFill.style.width = progress + '%';
            }
        }
    }

    // Initialisation
    const chapterManager = new ChapterManager();
    document.addEventListener('DOMContentLoaded', function() {
        chapterManager.loadChapter();
    });
    </script>
</body>
</html>
